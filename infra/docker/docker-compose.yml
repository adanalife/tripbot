version: '3.7'

services:
  tripbot:
    env_file:
      - infra/docker/env.docker
    build:
      context: .
      dockerfile: infra/docker/tripbot/Dockerfile
    depends_on:
      - db
      - vlc
      - mpd
    ports:
      # this should match the TRIPBOT_SERVER_PORT env var
      - "8080"
    #TODO: do we even need this?
    volumes:
      - ./assets/video:/danalol/Dashcam/_all

  vlc:
    env_file:
      - infra/docker/env.docker
    build:
      context: .
      dockerfile: infra/docker/vlc/Dockerfile
    ports:
      # this should match the VLC_SERVER_PORT env var
      - "8090"
    volumes:
      - ./assets/video:/danalol/Dashcam/_all

  #TODO: change credentials
  #TODO: share data volume
  db:
    image: postgres
    restart: always
    ports:
      - "5432"
    environment:
      POSTGRES_PASSWORD: example
      POSTGRES_USER: example
      POSTGRES_DB: tripbot_dev

  mpd:
    image: wernight/mopidy
    ports:
      - "6600:6601"
      # - "6680:6680"
    volumes:
      - ./infra/mopidy.conf:/config/mopidy.conf
    # devices:
    #   - /dev/snd
    restart: unless-stopped
